{% extends "excerptexport/layouts/base.html" %}

{% block main %}
    <nav>
        <a href="{% url 'excerptexport:index' %}">&#8810; Home</a>
    </nav>

    <a href=""><button>&#8635; Reload</button></a>
    <h2>Status extraction order #{{ extraction_order.id }}</h2>
    <table>
        <body>
            <tr>
                <tr><th>ID</th><td>{{ extraction_order.id }}</td>
                <tr><th>Excerpt</th><td>{{ extraction_order.excerpt.name }}</td>
                <tr>
                    <th>Status</th>
                    <td>
                        {% if extraction_order.get_state_display == 'UNDEFINED' %}
                            <span style="color: maroon;">&quest;</span>
                        {% elif extraction_order.get_state_display == 'INITIALIZED' %}
                            <span style="color: cornflowerblue;">&bigstar;</span>
                        {% elif extraction_order.get_state_display == 'WAITING' %}
                            <span style="color: gold; display: inline-block; -ms-transform: rotate(90deg); -webkit-transform: rotate(90deg); transform: rotate(90deg);">&bowtie;</span>
                        {% elif extraction_order.get_state_display == 'PROCESSING' %}
                            <span style="color: olive;">&#8635;</span>
                        {% elif extraction_order.get_state_display == 'FINISHED' %}
                            <span style="color: seagreen;">&check;</span>
                        {% elif extraction_order.get_state_display == 'CANCELED' %}
                            <span style="color: maroon;">&Chi;</span>
                        {% endif %}
                        {{ extraction_order.get_state_display }}
                    </td>
                </tr>
                {% if extraction_order.process_start_date %}
                <tr><th>Extraction started at</th><td>{{ extraction_order.process_start_date|date:"r" }}</td>
                {% endif %}
                <tr><th>Issuer</th><td>{{ extraction_order.orderer.get_username }}</td></tr>
        </body>
    </table>

    {% if extraction_order.get_state_display == 'FINISHED' %}
        <h3>Downloads (Î£:{{ extraction_order.output_files.count }})</h3>
        {% include 'excerptexport/partials/download_list.html' with files=extraction_order.output_files host_domain=host_domain %}

        <a href="mailto:?subject=Download%20map%20data%20of%20{{ extraction_order.excerpt.name }}&body=
{% for file in extraction_order.output_files.all %}
http://{{ host_domain }}{% url 'excerptexport:download' %}?file={{ file.public_identifier }}%0D%0A
{% endfor %}
            ">
            <button>&#9993; Send all links</button>
        </a>

    {% endif %}
{% endblock %}